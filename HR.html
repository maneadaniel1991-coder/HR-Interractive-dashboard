<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive HR Analytics Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex flex-col lg:flex-row h-screen">
        <!-- Sidebar -->
        <aside class="w-full lg:w-1/4 bg-gray-800 text-white p-6 flex flex-col">
            <header class="mb-8">
                <h1 class="text-2xl font-bold text-cyan-400">HR Analytics</h1>
                <p class="text-sm text-gray-400 mt-1">Interactive Attrition Dashboard</p>
            </header>

            <div class="flex-grow overflow-y-auto pr-2">
                <!-- File Input -->
                <div class="mb-6">
                    <label for="csv-file" class="block mb-2 text-sm font-semibold">1. Select HR Data File</label>
                    <input type="file" id="csv-file" accept=".csv" class="block w-full text-sm text-gray-300 bg-gray-700 rounded-lg border border-gray-600 cursor-pointer focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-l-lg file:border-0 file:text-sm file:font-semibold file:bg-gray-600 file:text-gray-300 hover:file:bg-gray-500">
                </div>

                <!-- Filters -->
                <div id="filters" class="hidden">
                    <h2 class="text-sm font-semibold mb-2">2. Filters</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="department-filter" class="block text-xs font-medium text-gray-400 mb-1">Department</label>
                            <select id="department-filter" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                                <option value="all">All Departments</option>
                            </select>
                        </div>
                        <div>
                            <label for="jobrole-filter" class="block text-xs font-medium text-gray-400 mb-1">Job Role</label>
                            <select id="jobrole-filter" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500">
                                <option value="all">All Job Roles</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
             <footer class="text-center text-xs text-gray-500 mt-6">
                <p>Portfolio Project by Daniel-Alexandru Manea</p>
            </footer>
        </aside>

        <!-- Main Content -->
        <main class="w-full lg:w-3/4 p-6 overflow-y-auto">
             <!-- Initial Prompt / Loading State -->
            <div id="initial-prompt" class="flex items-center justify-center h-full">
                <p class="text-lg font-semibold text-gray-500">Please select your HR data file to begin.</p>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboard" class="hidden">
                <!-- KPIs -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white p-5 rounded-xl shadow flex items-center gap-4">
                        <div class="bg-blue-100 p-3 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg></div>
                        <div>
                            <h2 class="text-gray-500 text-sm font-medium">Total Employees</h2>
                            <p id="total-employees" class="text-2xl font-bold"></p>
                        </div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow flex items-center gap-4">
                        <div class="bg-red-100 p-3 rounded-full"><svg xmlns="http://www.w.org/2000/svg" class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6" /></svg></div>
                        <div>
                            <h2 class="text-gray-500 text-sm font-medium">Total Attrition</h2>
                            <p id="total-attrition" class="text-2xl font-bold"></p>
                        </div>
                    </div>
                    <div class="bg-white p-5 rounded-xl shadow flex items-center gap-4">
                        <div class="bg-yellow-100 p-3 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18" /></svg></div>
                        <div>
                            <h2 class="text-gray-500 text-sm font-medium">Attrition Rate</h2>
                            <p id="attrition-rate" class="text-2xl font-bold"></p>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-lg font-semibold mb-4">Attrition by Job Role</h3>
                        <div class="chart-container"><canvas id="attritionByJobRoleChart"></canvas></div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-lg font-semibold mb-4">Attrition by Department</h3>
                        <div class="chart-container"><canvas id="attritionByDeptChart"></canvas></div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-lg font-semibold mb-4">Attrition vs. Monthly Income</h3>
                        <div class="chart-container"><canvas id="attritionByIncomeChart"></canvas></div>
                    </div>
                     <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-lg font-semibold mb-4">Attrition by Years at Company</h3>
                        <div class="chart-container"><canvas id="attritionByTenureChart"></canvas></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let originalData = [];
        const chartInstances = {};

        document.getElementById('csv-file').addEventListener('change', handleFileSelect);
        document.getElementById('department-filter').addEventListener('change', applyFilters);
        document.getElementById('jobrole-filter').addEventListener('change', applyFilters);

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const prompt = document.getElementById('initial-prompt');
            prompt.innerHTML = '<p class="text-lg font-semibold text-gray-500">Loading and processing data...</p>';

            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    originalData = results.data.filter(row => row && row.Attrition);
                    populateFilters();
                    document.getElementById('filters').classList.remove('hidden');
                    applyFilters(); // Initial display
                },
                error: (error) => {
                    console.error("Error parsing CSV:", error);
                    prompt.innerText = 'Error: Could not parse the selected file.';
                }
            });
        }

        function populateFilters() {
            const departments = [...new Set(originalData.map(row => row.Department))];
            const jobRoles = [...new Set(originalData.map(row => row.JobRole))];
            
            const deptFilter = document.getElementById('department-filter');
            departments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                deptFilter.appendChild(option);
            });

            const roleFilter = document.getElementById('jobrole-filter');
            jobRoles.forEach(role => {
                const option = document.createElement('option');
                option.value = role;
                option.textContent = role;
                roleFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const deptValue = document.getElementById('department-filter').value;
            const roleValue = document.getElementById('jobrole-filter').value;

            let filteredData = originalData;

            if (deptValue !== 'all') {
                filteredData = filteredData.filter(row => row.Department === deptValue);
            }
            if (roleValue !== 'all') {
                filteredData = filteredData.filter(row => row.JobRole === roleValue);
            }
            
            updateDashboard(filteredData);
        }

        function updateDashboard(data) {
            document.getElementById('initial-prompt').style.display = 'none';
            document.getElementById('dashboard').classList.remove('hidden');

            // --- 1. KPI Calculations ---
            const totalEmployees = data.length;
            const totalAttrition = data.filter(row => row.Attrition === 'Yes').length;
            const attritionRate = totalEmployees > 0 ? (totalAttrition / totalEmployees) * 100 : 0;

            document.getElementById('total-employees').innerText = totalEmployees.toLocaleString();
            document.getElementById('total-attrition').innerText = totalAttrition.toLocaleString();
            document.getElementById('attrition-rate').innerText = `${attritionRate.toFixed(1)}%`;

            // --- 2. Chart Data Processing ---
            const attritionData = data.filter(r => r.Attrition === 'Yes');

            const roleAttrition = {};
            attritionData.forEach(row => {
                const role = row.JobRole;
                if (!roleAttrition[role]) roleAttrition[role] = 0;
                roleAttrition[role]++;
            });
            const sortedRoles = Object.entries(roleAttrition).sort(([,a],[,b]) => a-b);
            renderChart('attritionByJobRoleChart', 'bar', sortedRoles.map(e => e[0]), sortedRoles.map(e => e[1]), 'Number of Attritions', {indexAxis: 'y'});

            const deptAttrition = {};
            attritionData.forEach(row => {
                const dept = row.Department;
                if (!deptAttrition[dept]) deptAttrition[dept] = 0;
                deptAttrition[dept]++;
            });
            renderChart('attritionByDeptChart', 'pie', Object.keys(deptAttrition), Object.values(deptAttrition));

            const incomeData = { yes: [], no: [] };
            data.forEach(row => {
                const point = {x: row.MonthlyIncome, y: row.Age};
                (row.Attrition === 'Yes' ? incomeData.yes : incomeData.no).push(point);
            });
            renderScatterChart('attritionByIncomeChart', incomeData.no, incomeData.yes);

            const tenureAttrition = {};
            attritionData.forEach(row => {
                const years = row.YearsAtCompany;
                if (!tenureAttrition[years]) tenureAttrition[years] = 0;
                tenureAttrition[years]++;
            });
            const tenureLabels = Object.keys(tenureAttrition).sort((a,b) => parseInt(a) - parseInt(b));
            const tenureData = tenureLabels.map(label => tenureAttrition[label]);
            renderChart('attritionByTenureChart', 'line', tenureLabels, tenureData, 'Number of Attritions');
        }
        
        function renderChart(canvasId, type, labels, data, label, options = {}) {
            if (chartInstances[canvasId]) chartInstances[canvasId].destroy();
            const ctx = document.getElementById(canvasId).getContext('2d');
            chartInstances[canvasId] = new Chart(ctx, {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: ['rgba(54, 162, 235, 0.6)', 'rgba(255, 99, 132, 0.6)', 'rgba(75, 192, 192, 0.6)', 'rgba(255, 206, 86, 0.6)', 'rgba(153, 102, 255, 0.6)', 'rgba(255, 159, 64, 0.6)'],
                        borderColor: ['rgba(54, 162, 235, 1)', 'rgba(255, 99, 132, 1)', 'rgba(75, 192, 192, 1)', 'rgba(255, 206, 86, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'],
                        borderWidth: 1,
                        tension: 0.1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, ...options, plugins: { legend: { display: type === 'pie' || type === 'doughnut' } } }
            });
        }

        function renderScatterChart(canvasId, dataNo, dataYes) {
            if (chartInstances[canvasId]) chartInstances[canvasId].destroy();
            const ctx = document.getElementById(canvasId).getContext('2d');
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        { label: 'No Attrition', data: dataNo, backgroundColor: 'rgba(54, 162, 235, 0.6)' },
                        { label: 'Yes Attrition', data: dataYes, backgroundColor: 'rgba(255, 99, 132, 0.6)' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'Monthly Income' } },
                        y: { title: { display: true, text: 'Age' } }
                    }
                }
            });
        }
    </script>

</body>
</html>
